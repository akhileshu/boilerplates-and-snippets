// /app/api/set-offline/route.ts
import { db } from "@/lib/firebase";
import { doc, setDoc, serverTimestamp } from "firebase/firestore";
import { prisma } from "@/lib/prisma";

export async function POST(req: Request) {
  const { searchParams } = new URL(req.url);
  const userId = searchParams.get("userId");

  if (!userId) return new Response("Missing userId", { status: 400 });

  // Mark offline in Firestore
  await setDoc(doc(db, "status", userId), {
    state: "offline",
    last_changed: serverTimestamp(),
  });

  // Optional: update Prisma flag too
  await prisma.user.update({
    where: { id: userId },
    data: { isOnline: false },
  });

  return new Response("OK");
}


model User {
  id        String @id @default(cuid())
  name      String?
  isOnline  Boolean @default(false) // optional: sync from Firestore API
  ...
}
